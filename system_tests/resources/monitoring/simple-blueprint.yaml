tosca_definitions_version: cloudify_dsl_1_3


imports:
  - http://cloudify.co/spec/cloudify/4.5/types.yaml
  - ../../../plugin.yaml


inputs:

  client_x509_cert_url:
    type: string
    default: { get_secret: client_x509_cert_url }

  client_email:
    type: string
    default: { get_secret: client_email }

  client_id:
    type: string
    default: { get_secret: client_id }

  project_id:
    type: string
    default: { get_secret: project_id }

  private_key_id:
    type: string
    default: { get_secret: private_key_id }

  private_key:
    type: string
    default: { get_secret: private_key }

  zone:
    type: string
    default: { get_secret: zone }

  region:
    type: string
    default: { get_secret: region }

  resource_prefix:
    type: string
    default: ex


dsl_definitions:
  - &gcp_config
    auth:
      type: service_account
      auth_uri: https://accounts.google.com/o/oauth2/auth
      token_uri: https://accounts.google.com/o/oauth2/token
      auth_provider_x509_cert_url: https://www.googleapis.com/oauth2/v1/certs
      client_x509_cert_url: { get_input: client_x509_cert_url }
      client_email: { get_input: client_email }
      client_id: { get_input: client_id }
      project_id: { get_input: project_id }
      private_key_id: { get_input: private_key_id }
      private_key: { get_input: private_key }
    project: { get_input: project_id }
    zone: { get_input: zone }

  - &time_series
    timeSeries:
      metric:
        type: custom.googleapis.com/sample/test
      points:
        interval:
          startTime: '2018-7-04T02:01:23.045123456Z'
          endTime: '2018-7-04T02:01:23.045123456Z'
        value:
          int64Value: '55'

  - &uptime_check_config
    displayName: uptimechecktest
    timeout: 30s
    monitoredResource:
      type: gce_instance
      labels:
        instance_id: '1302283736210028991'
        zone: asia-east1-b

node_templates:
  stackdriver_group:
    type: cloudify.gcp.nodes.StackDriverGroup
    properties:
      gcp_config: *gcp_config
      project_id: { get_input: project_id }
      display_name: group-test
      filter_name: resource.metadata.name=has_substring("test")

  stackdriver_timeseries:
    type: cloudify.gcp.nodes.StackDriverTimeSeries
    properties:
      gcp_config: *gcp_config
      project_id: sample-project
      time_series: *time_series

  stackdriver_uptime_check_group:
    type: cloudify.gcp.nodes.StackDriverUpTimeCheckConfig
    properties:
      gcp_config: *gcp_config
      project_id: sample-project
      uptime_check_config: *uptime_check_config



