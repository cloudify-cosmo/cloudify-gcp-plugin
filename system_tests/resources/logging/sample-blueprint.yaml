tosca_definitions_version: cloudify_dsl_1_3


imports:
  - http://cloudify.co/spec/cloudify/4.5/types.yaml
  - ../../../plugin.yaml


inputs:

  client_x509_cert_url:
    type: string
    default: { get_secret: client_x509_cert_url }

  client_email:
    type: string
    default: { get_secret: client_email }

  client_id:
    type: string
    default: { get_secret: client_id }

  project_id:
    type: string
    default: { get_secret: project_id }

  private_key_id:
    type: string
    default: { get_secret: private_key_id }

  private_key:
    type: string
    default: { get_secret: private_key }

  zone:
    type: string
    default: { get_secret: zone }

  region:
    type: string
    default: { get_secret: region }

  resource_prefix:
    type: string
    default: ex


dsl_definitions:

  - &gcp_config
    auth:
      type: service_account
      auth_uri: https://accounts.google.com/o/oauth2/auth
      token_uri: https://accounts.google.com/o/oauth2/token
      auth_provider_x509_cert_url: https://www.googleapis.com/oauth2/v1/certs
      client_x509_cert_url: { get_input: client_x509_cert_url }
      client_email: { get_input: client_email }
      client_id: { get_input: client_id }
      project_id: { get_input: project_id }
      private_key_id: { get_input: private_key_id }
      private_key: { get_input: private_key }
    project: { get_input: project_id }
    zone: { get_input: zone }

  - &log_exclusion
      name: test-name
      filter: "'projects/my-project/logs/syslog' AND sample(insertId, 0.25)"

  - &log_sink
    name: test-name
    destination: pubsub.googleapis.com/projects/sample-project/topics/test123

  - &log_metric
    name: test-name
    filter: "'projects/my-project/logs/syslog'"

node_templates:
  billing_account_exclusion:
    type: cloudify.gcp.nodes.Logging.BillingAccounts.exclusions
    properties:
      gcp_config: *gcp_config
      log_exclusion: *log_exclusion
      parent: billingAccounts/AAAAAA-YYYYYY-XXXXXX

  billing_account_sink:
    type: cloudify.gcp.nodes.Logging.BillingAccounts.sinks
    properties:
      gcp_config: *gcp_config
      log_sink: *log_sink
      parent: billingAccounts/AAAAAA-YYYYYY-XXXXXX

  folder_exclusion:
    type: cloudify.gcp.nodes.Logging.Folders.exclusions
    properties:
      gcp_config: *gcp_config
      log_exclusion: *log_exclusion
      parent: folders/999993822509

  folder_sink:
    type: cloudify.gcp.nodes.Logging.Folders.sinks
    properties:
      gcp_config: *gcp_config
      log_sink: *log_sink
      parent: folders/999993822509

  organization_exclusion:
    type: cloudify.gcp.nodes.Logging.Organizatios.exclusions
    properties:
      gcp_config: *gcp_config
      log_exclusion: *log_exclusion
      parent: organizations/999916624432

  organization_sink:
    type: cloudify.gcp.nodes.Logging.Organizations.sinks
    properties:
      gcp_config: *gcp_config
      log_sink: *log_sink
      parent: organizations/999916624432

  project_exclusion:
    type: cloudify.gcp.nodes.Logging.Projects.exclusions
    properties:
      gcp_config: *gcp_config
      log_exclusion: *log_exclusion
      parent: projects/sample-project

  project_sink:
    type: cloudify.gcp.nodes.Logging.Projects.sinks
    properties:
      gcp_config: *gcp_config
      log_sink: *log_sink
      parent: projects/sample-project

  project_metrics:
    type: cloudify.gcp.nodes.Logging.Projects.metrics
    properties:
      gcp_config: *gcp_config
      log_metric: *log_metric
      parent: projects/sample-project
